{% extends "base.html" %}
{% load thumbnail %}
{% load humanize %}

{% block content %}

<div class="w3-row raykomfi-main-padding w3-round-large raykomfi-max-width">
    <div class="w3-col s12 m4 l4 w3-hide-small">
        <h4>إستفسارات مشابهة</h4>
        <div class="related-posts w3-border w3-padding-16 w3-white">
            <div class="w3-row">
                <div class="w3-mobile">
                    {% for related_post in related_posts %}
                    <div class="w3-margin">
                        <a href="{{ related_post.get_absolute_url }}">

                            {% if related_post.creator and related_post.creator.is_active != False %}
                            <span class="w3-round-small w3-right">
                                {{related_post.creator}}
                            </span>
                            {% else %}
                            <span class="w3-round-small w3-right">عضو لم يعد مسجل</span>
                            {% endif %}

                            &nbsp; <span class="raykomfi-color">{{related_post.title}}</span></a>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    <div class="w3-col s12 m8 l8">
        <div class="w3-row">
            <div class="w3-mobile w3-container">
                {% if post.creator and post.creator.is_active != False %}
                <a href="{% url 'raykomfi:user-profile' id=post.creator.id %}" class="writer-name">
                    <h2>
                        <i class="fa fa-user" aria-hidden="true"></i>
                        {{post.creator}}
                    </h2>
                </a>
                {% else %}
                <h2>
                    <i class="fa fa-user" aria-hidden="true"></i>
                    عضو لم يعد مسجل
                </h2>
                {% endif %}
            </div>
            <div class="w3-mobile w3-container">
                <h3>{{post.title}}</h3>
                {% if post.content %}
                <p>{{post.content}}</p>
                {% endif %}
            </div>
            <div class="w3-mobile w3-container">
                {% if post.image %}

                <!-- Trigger the Modal -->
                <img id="myImg" src="{{ post.image.url }}" alt="{{post.title}}" data-src="{{ post.image.url }}"
                    class="lazy-img">

                <!-- The Modal -->
                <div id="myModal" class="modal">

                    <!-- Modal Content (The Image) -->
                    <img class="modal-content" id="modalImage">

                    <!-- Modal Caption (Image Text) -->
                    <div id="caption"></div>
                </div>

                {% endif %}
            </div>
            <div class="w3-container">
                <div><small><i class="fa fa-clock-o" aria-hidden="true"></i> {{post.created | naturaltime}}</small>
                </div>
                <div><small><i class="fa fa-tags" aria-hidden="true"></i> {{post.category}}</small></div>
            </div>
            <div class="w3-mobile w3-container reply-buttons">
                <hr>
                <h3>الاراء</h3>
                <div id="posts-wrapper">
                    {% if post.comments.all|length > 0 %}
                    {% for comment in post.comments.all %}
                    <div class="w3-row comment-wrapper w3-border w3-padding w3-round-large">
                        <div class="w3-col s10 m11 l11" id="comment-id-{{comment.id}}">
                            <div class="comment-side">
                                {% if comment.user and reply.user.is_active != False %}
                                <a href="{% url 'raykomfi:user-profile' id=comment.post.creator.id %}"
                                    class="writer-name">
                                    <div class="name">
                                        <i class="fa fa-user" aria-hidden="true"></i>
                                        {{comment.user.username}}
                                    </div>
                                </a>
                                {% else %}
                                <div class="name">
                                    <i class="fa fa-user" aria-hidden="true"></i>
                                    عضو لم يعد مسجل
                                </div>
                                {% endif %}
                                <small><i class="fa fa-clock-o" aria-hidden="true"></i>
                                    {{comment.created | naturaltime}}</small>
                                <div class="comment">{{ comment.content }}</div>
                            </div>
                            <hr>
                            {% if comment.replies.all|length > 0 %}
                            <div class="comment-reply-side w3-padding w3-round-large">
                                {% for reply in comment.replies.all %}
                                <div class="w3-panel" id="to-{{reply.id}}">
                                    {% if reply.user and reply.user.is_active != False %}
                                    <a href="{% url 'raykomfi:user-profile' id=reply.user.id %}" class="writer-name">
                                        <div class="name"><i class="fa fa-user" aria-hidden="true"></i>
                                            {{reply.user.username}}
                                        </div>
                                    </a>
                                    {% else %}
                                    <div class="name"><i class="fa fa-user" aria-hidden="true"></i>
                                        عضو لم يعد مسجل
                                    </div>
                                    {% endif %}
                                    <small><i class="fa fa-clock-o" aria-hidden="true"></i>
                                        {{reply.created | naturaltime}}</small>
                                    <div class="comment">{{ reply.content }}</div>
                                </div>
                                {% endfor %}
                            </div>
                            {% endif %}
                            {% if user.email_active %}
                            <div class="reply">
                                <form class="replyForm" data-comment-id="{{comment.id}}">
                                    <textarea name="reply_content" cols="40" rows="1"
                                        class="w3-input w3-border  w3-round-large reply-textarea"
                                        id="id_reply_content-{{comment.id}}"></textarea>
                                    <div class="col s12">
                                        <button class='w3-button w3-round-large' type="submit"> اضافة رد</button>
                                    </div>
                                </form>
                            </div>
                            {% endif %}
                        </div>
                        <div class="w3-col s2 m1 l1 w3-center vote-side" id="comment-{{comment.id}}-vote-side-wrapper">
                            <div>
                                <form class="voteForm" data-comment-id="{{comment.id}}" data-user-id={{user.id}}
                                    data-vote-type="like">
                                    <button type="submit" {% if user in comment.voted_like.all %} disabled {% endif %}
                                        class="like-button"><i class="fa fa-thumbs-up" aria-hidden="true"></i></button>
                                </form>
                            </div>
                            <div>{{comment.votes}}</div>
                            <div>
                                <form class="voteForm" data-comment-id="{{comment.id}}" data-user-id={{user.id}}
                                    data-vote-type="dislike">
                                    <button type="submit" {% if user in comment.voted_dislike.all %} disabled
                                        {% endif %} class="dislike-button"><i class="fa fa-thumbs-down"
                                            aria-hidden="true"></i></button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <p>لا يوجد رأي حتى الان, كن أول شخص يعطي رأيه</p>
                    {% endif %}
                </div>
            </div>
            <div class="sk-chase" id="sk-chase">
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
            </div>
            <div class="lazy-load-linkwrapper w3-center">
                <a id="lazyLoadLinkComments" class="w3-border w3-padding" href="javascript:void(0);" data-page="2">عرض
                    المزيد</a>
            </div>
            <input type="hidden" id="post_id" value={{post.id}}>
            <div class="w3-mobile w3-container comment-button">
                <h3>اضافة تعليق</h3>

                {% if not user.is_authenticated %}
                <div class="w3-display-container w3-panel w3-pale-yellow w3-border message-wrapper">
                    <p class="w3-center"><a href="{% url 'raykomfi:user-register' %}" class="w3-text-blue">سجل حساب
                            جديد</a> أو <a href="{% url 'raykomfi:user-signin' %}" class="w3-text-blue">سجل الدخول</a>
                        للمشاركة في التعليقات</p>
                </div>

                {% else %}

                {% if user.email_active %}
                <div id="comment">
                    <form class="commentForm" data-post-id="{{post.id}}">
                        <textarea cols="40" rows="10" class="w3-input w3-border  w3-round-large"></textarea>
                        <div class="col s12">
                            <button class='w3-button raykomfi-button w3-round-large'>
                                اضافة تعليق</button>
                        </div>
                    </form>
                </div>
                {% else %}
                <div class="w3-display-container w3-panel w3-border message-wrapper w3-pale-yellow">
                    <p class="w3-center">فعل حسابك للمشاركة في التعليقات</p>
                </div>

                {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    <div class="w3-col s12 m4 l4 w3-hide-medium w3-hide-large">
        <h4>إستفسارات مشابهة</h4>
        <div class="related-posts w3-border w3-padding-16 w3-white">
            <div class="w3-row">
                <div class="w3-mobile">
                    {% for related_post in related_posts %}
                    <div class="w3-margin">
                        <a href="{{ related_post.get_absolute_url }}">

                            {% if related_post.creator and related_post.creator.is_active != False %}
                            <span class="w3-round-small w3-right">
                                {{related_post.creator}}
                            </span>
                            {% else %}
                            <span class="w3-round-small w3-right">عضو لم يعد مسجل</span>
                            {% endif %}

                            &nbsp; <span class="raykomfi-color">{{related_post.title}}</span></a>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    {% endblock content %}