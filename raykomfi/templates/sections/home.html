{% extends "base.html" %}
{% load thumbnail %}
{% load humanize %}
{% load hitcount_tags %}
{% load static %}


{% block content %}


<div class="w3-row-padding">
    <div class="w3-col l1 w3-hide-small">&nbsp</div>
    <div class="w3-col s12 m4 l4 w3-hide-small">
        <div class="w3-padding w3-white z-depth-1">
            <h4 class="w3-center">آخر الآراء</h4>
            {% for comment in latest_comments %}
            <div class="w3-row latest-opinion">
                {% if comment.user and comment.user.is_active != False %}
                <a href="{% url 'raykomfi:user-profile' id=comment.user.id %}"><span><i class="fa fa-user"
                            aria-hidden="true"></i> {{comment.user}}</span></a>
                {% else %}
                <span><i class="fa fa-user" aria-hidden="true"></i> مجهول</span>
                {% endif %}
                <p>{{ comment.content }}</p>
                <div class="">
                    <span class="w3-tag  w3-red w3-center w3-small"><i class="fa fa-reply" aria-hidden="true"></i>رد
                        على</span>
                    <a href="{{ comment.post.get_absolute_url }}" class="">{{ comment.post.title }}</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="w3-col s12 m8 l6 ray ">
        <div class="w3-row center w3-hide-large w3-hide-medium ">
            <a href="/"><img src="{% static 'img/logo.png' %}" class="logo logo-mobile" alt="شعار رايكم في"></a>
        </div>
        <div class="w3-row">
            <div class="w3-bar w3-white  ray-order z-depth-1">
                <div class="w3-bar-item  w3-right"> <a href="{% url 'raykomfi:latest-posts' %}"
                        class="order-btn"><button class="w3-button  raykomfi-main-background-color z-depth-1"><i
                                class="fa fa-sort-amount-desc" aria-hidden="true"></i>
                            الأحدث</button></a></div>
                <div class="w3-bar-item  w3-right"><a href="{% url 'raykomfi:most-discussed-posts' %}"
                        class="order-btn"><button class="w3-button  raykomfi-main-background-color z-depth-1"><i
                                class="fa fa-commenting" aria-hidden="true"></i>
                            الأكثر مناقشة</button></a></div>
                <div class="w3-bar-item  w3-right"><a href="{% url 'raykomfi:most-searched-posts' %}"
                        class="order-btn"><button class="w3-button  raykomfi-main-background-color z-depth-1"><i
                                class="fa fa-fire" aria-hidden="true"></i>
                            الأكثر بحثا</button></a></div>
                <div class="w3-bar-item  w3-right w3-dropdown-hover  order-btn">
                    <button class="w3-button  raykomfi-main-background-color z-depth-1"><i class="fa fa-tags"
                            aria-hidden="true"></i>
                        حسب التصنيف</button>
                    <div class="w3-dropdown-content raykomfi-category-dropdown w3-bar-block  w3-card z-depth-1">
                        {% for category in categories %}
                        <a href="{% url 'raykomfi:filtered-posts' category=category.name %}"
                            class="w3-bar-item w3-button">{{category.name}}</a>
                        {% endfor %}
                    </div>

                </div>
                {% if url_name != 'categorized_view' %}
                <div class="w3-bar-item w3-right">
                    <button class="w3-button  raykomfi-main-background-color order-btn" id="search-btn">
                        <i class="fa fa-search"></i> بحث </button>
                </div>
                {% endif %}
            </div>
        </div>
        <div class="w3-row" id="search-field-wrapper">
            <div class="w3-col w3-padding w3-white z-depth-1">
                <div class="spinner" id="spinner">
                    <div class="bounce1"></div>
                    <div class="bounce2"></div>
                    <div class="bounce3"></div>
                </div>
                <form class="postsSearchForm">
                    {% csrf_token %}
                    <input class="w3-input search-input" type="text" placeholder="بحث عن إستفسار ..." name="q">
                </form>
            </div>
        </div>
        {% if user.is_authenticated and user.email_active%}
        <div id="user-of-the-month">
            <ul class="collapsible">
                <li>
                    <div class="collapsible-header">أعضاء
                        الشهر <span class="w3-round white-text black what-is-this">ما هذا؟ <div
                                class="what-is-this-content">ترتيب أفضل 10 أعضاء حسب التصويتات التي حصلو عليها عن طريق
                                آرائهم خلال
                                الشهر الماضي, الأول والثاني يحصلون على نجمة كاملة بينما الباقين يحصلون على نصف نجمة,
                                فائدة النجوم لرفع من قوة رأي كل حساب</div></span>
                        <i class="fa fa-star" aria-hidden="true"></i>
                        <i class="fa fa-star" aria-hidden="true"></i>
                        <i class="fa fa-star" aria-hidden="true"></i>
                        <i class="fa fa-star" aria-hidden="true"></i>
                    </div>
                    <div class="collapsible-body white best-user-wrapper" id="display-best-users">
                        <div class="sk-chase" id="sk-chase-best-user">
                            <div class="sk-chase-dot"></div>
                            <div class="sk-chase-dot"></div>
                            <div class="sk-chase-dot"></div>
                            <div class="sk-chase-dot"></div>
                            <div class="sk-chase-dot"></div>
                            <div class="sk-chase-dot"></div>
                        </div>
                        <ol>

                        </ol>
                    </div>
                </li>
            </ul>
        </div>
        {% endif %}
        {% if not user.is_authenticated %}
        <div class="w3-display-container w3-panel w3-pale-yellow w3-border message-wrapper register-message">
            <p class="w3-center"><a href="{% url 'raykomfi:user-register' %}" class="w3-text-blue">سجل حساب جديد</a> أو
                <a href="{% url 'raykomfi:user-signin' %}" class="w3-text-blue">سجل الدخول</a> لإستفسار الناس عن ما تريد
                الشراء</p>
        </div>
        <div class="w3-display-container w3-panel center">
            <p class="w3-center btn raykomfi-main-background-color"><a href="{% url 'raykomfi:post-new-withnoregistration' %}" class="white-text"> إستفسار بدون تسجيل </a> </p>
        </div>
        {% else %}
        {% if user.email_active %}

        <div class="new-post-side">
            <a href="{% url 'raykomfi:post-new' %}" title="اضافة إستفسار جديد">
                <button class="w3-button w3-center z-depth-2"><i class="fa fa-plus" aria-hidden="true"></i>
                </button>
            </a>
        </div>

        {% else %}
        <div class="w3-display-container w3-panel w3-pale-yellow w3-border message-wrapper">
            <p class="w3-center">فعل حسابك للإستفسار الناس عن ما تريد الشراء</p>
        </div>
        {% endif %}
        {% endif %}
        {% if url_name == 'categorized_view' %}
        <div class="categorized-text">التصنيف {{ category }}</div>
        {% endif %}
        <div id="raykomfi-posts">
            {% if count > 0 or count_categorized > 0%}
            {% for post in posts %}
            <div class="w3-padding ray-box  z-depth-1">
                {% if post.creator and post.creator.is_active != False %}
                <a href="{% url 'raykomfi:user-profile' id=post.creator.id %}">
                    <span class="poster-name">
                        <i class="fa fa-user" aria-hidden="true"></i>
                        {{post.creator}}
                    </span>
                </a>
                {% else %}
                <span class="poster-name">
                    <i class="fa fa-user" aria-hidden="true"></i>
                    مجهول
                </span>
                {% endif %}
                <a href="{{post.get_absolute_url}}">
                    <h3>{{post.title |truncatechars:100}}</h3>
                    {% if post.image and post.image_source %}
                    <div class="ray-image-section">
                        <img src="" alt="{{post.title}}" data-src="{{ post.image.url }}"
                            class="lazy-img w3-round-large">
                        <div>
                            <a href="{{ post.image_source }}" target="_blank">مصدر الصورة</a>
                        </div>
                    </div>
                    {% endif %}
                    <div class="ray-box-footer-icons">
                        <div class="">
                            <span><i class="fa fa-clock-o" aria-hidden="true"></i>
                                <span class='created-time'>{{post.created | naturaltime}}</span></span>
                        </div>
                        <div class="">
                            <span><i class="fa fa-comments" aria-hidden="true"></i> {{post.comments.count}}</span>
                        </div>
                        <div class="">
                            <span><i class="fa fa-eye" aria-hidden="true"></i> {% get_hit_count for post %}</span>
                        </div>
                        <div class="">
                            <span><i class="fa fa-tags" aria-hidden="true"></i> {{post.category}}</span>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
            {% else %}
            <p class="center">لا يوجد نتائج حاليا, كن أول من يستفسر</p>
            {% endif %}
        </div>
        <div class="sk-chase" id="sk-chase">
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
        </div>
        {% if hide_load_more == True or count < 8 or count_categorized < 6 %}

        {% else %}
        {% if is_categorized == True %}
        <div class="lazy-load-linkwrapper w3-center">
            <a id="lazyLoadLink" class="w3-border w3-padding raykomfi-button z-depth-1" href="javascript:void(0);"
                data-page="2" data-category="{{category}}">عرض المزيد</a>
        </div>
        {% else %}
        <div class="lazy-load-linkwrapper w3-center">
            <a id="lazyLoadLink" class="w3-padding raykomfi-button z-depth-1" href="javascript:void(0);"
                data-page="2">عرض
                المزيد</a>
        </div>
        {% endif %}
        {% endif %}

    </div>
    <div class="w3-col s12 m4 l4 w3-hide-medium w3-hide-large">
        <div class="w3-padding w3-white  z-depth-1">
            <h4 class="w3-center">اخر الأراء</h4>
            {% for comment in latest_comments %}
            <div class="w3-row latest-opinion">
                {% if comment.user and comment.user.is_active != False %}
                <a href="{% url 'raykomfi:user-profile' id=comment.user.id %}"><span><i class="fa fa-user"
                            aria-hidden="true"></i> {{comment.user}}</span></a>
                {% else %}
                <span><i class="fa fa-user" aria-hidden="true"></i> مجهول</span>
                {% endif %}
                <p>{{ comment.content }}</p>
                <div class="">
                    <span class="w3-tag  w3-red w3-center w3-small"><i class="fa fa-reply" aria-hidden="true"></i>رد
                        على</span>
                    <a href="{{ comment.post.get_absolute_url }}" class="">{{ comment.post.title }}</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="w3-col l1 w3-hide-small w3-hide-medium">&nbsp</div>
</div>

{% endblock content %}