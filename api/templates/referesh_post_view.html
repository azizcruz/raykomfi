{% load thumbnail %}
{% load humanize %}

{% if post.comments.all|length > 0 %}
{% for comment in post.comments.all %}
<div class="w3-row comment-wrapper w3-border w3-padding z-depth-1">
    <div class="w3-col s10 m11 l11" id="comment-id-{{comment.id}}">
        <div class="comment-side">
            {% if comment.user and reply.user.is_active != False %}
            <a href="{% url 'raykomfi:user-profile' id=comment.user.id %}" class="writer-name">
                <div class="name">
                    <i class="fa fa-user" aria-hidden="true"></i>
                    {{comment.user.username}}
                    <span class="opinion-power">
                        {{comment.user.user_trust}}
                    </span>
                </div>
            </a>
            {% else %}
            <div class="name">
                <i class="fa fa-user" aria-hidden="true"></i>
                مجهول
            </div>
            {% endif %}
            <small><i class="fa fa-clock-o" aria-hidden="true"></i><span
                    class="created-time">{{comment.created | naturaltime}}</span>
            </small>
            <div class="comment">{{ comment.content|safe }}</div>
            <form class="editCommentForm-{{comment.id}} closest-edit-comment-form" data-comment-id="{{comment.id}}">
                {% csrf_token %}
                <input type="text" name="content" class="w3-input w3-border">
                <button class="btn raykomfi-main-background-color raykomfi-report-btn" type="submit">تأكيد</button>
                <a href="" class="btn red raykomfi-report-btn close-comment-edit-form"
                    data-comment-id="{{comment.id}}">إلغاء</a>
            </form>
            {% if user.is_authenticated %}
            <button class="btn red raykomfi-report-btn comment-action-btn"
                onclick="document.getElementById('reportReply').style.display='block'">إبلاغ</button>
            {% if comment.user.id == user.id or user.is_staff %}
            <button class="btn green raykomfi-report-btn comment-action-btn edit-comment-btn"
                data-comment-id="{{ comment.id }}" data-content="{{comment.content}}">تعديل </button>
            {% endif %}
            {% endif %}
            <!-- The Comment Report Modal -->
            <div id="reportComment" class="w3-modal">
                <div class="w3-modal-content w3-animate-top">
                    <div class="container">
                        <div class="col s12 m6">
                            <div class="card">
                                <div class="card-content white-text">
                                    <h6>حدد نوع الإبلاغ</h6>
                                    <form class="reportForm">
                                        {% csrf_token %}
                                        <input class="w3-radio" type="radio" name="content" value="إساءة شخصية">
                                        <label class="black-text">إساءة
                                            شخصية</label>
                                        <br>
                                        <input class="w3-radio" type="radio" name="content"
                                            value="مخالف لشروط إستخدام المنصة">
                                        <label class="black-text">مخالف
                                            لشروط إستخدام
                                            المنصة</label>
                                        <br>
                                        <input class="w3-radio" type="radio" name="content"
                                            value="إساءة لطائفة أو إلى الدين">
                                        <label class="black-text">إساءة
                                            لطائفة أو إلى
                                            الدين</label>
                                        <input type="hidden" name="reported_url" value="{{comment.get_absolute_url}}">
                                        <br>

                                        <input type="hidden" name="topic" value="comment">
                                        <button type="submit"
                                            class="btn raykomfi-main-background-color send-report-btn">إرسال</button>

                                        <a class="btn red"
                                            onclick="document.getElementById('reportComment').style.display='none'">إغلاق</a>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- The Comment Report Modal -->
        </div>

        {% if comment.replies.all|length > 0 %}
        <div class="comment-reply-side w3-padding ">
            {% for reply in comment.replies.all %}
            <div class="w3-panel z-depth-1" id="to-{{reply.id}}">
                {% if reply.user and reply.user.is_active != False %}
                <a href="{% url 'raykomfi:user-profile' id=reply.user.id %}" class="writer-name">
                    <div class="name"><i class="fa fa-user" aria-hidden="true"></i>
                        {{reply.user.username}}
                    </div>
                </a>
                {% else %}
                <div class="name"><i class="fa fa-user" aria-hidden="true"></i>
                    مجهول
                </div>
                {% endif %}
                <small><i class="fa fa-clock-o" aria-hidden="true"></i><span class="created-time">
                        {{reply.created | naturaltime}}</span>
                </small>
                <div class="reply">{{ reply.content|safe }}</div>
                <form class="editReplyForm-{{reply.id}} closest-edit-reply-form" data-comment-id="{{comment.id}}"
                    data-reply-id="{{reply.id}}">
                    {% csrf_token %}
                    <input type="text" name="content" class="w3-input w3-border">
                    <button class="btn raykomfi-main-background-color raykomfi-report-btn" type="submit">تأكيد</button>
                    <a href="" class="btn red raykomfi-report-btn close-reply-edit-form"
                        data-reply-id="{{reply.id}}">إلغاء</a>
                </form>
                {% if user.is_authenticated %}
                <button class="btn red raykomfi-report-btn reply-action-btn"
                    onclick="document.getElementById('reportReply').style.display='block'">إبلاغ</button>
                {% if reply.user.id == user.id or user.is_staff %}
                <button class="btn green raykomfi-report-btn reply-action-btn edit-reply-btn"
                    data-reply-id="{{ reply.id }}" data-content="{{reply.content}}">تعديل
                </button>
                {% endif %}
                {% endif %}
                <!-- The Reply Report Modal -->
                <div id="reportReply" class="w3-modal">
                    <div class="w3-modal-content w3-animate-top">
                        <div class="container">
                            <div class="col s12 m6">
                                <div class="card">
                                    <div class="card-content white-text">
                                        <h6>حدد نوع الإبلاغ</h6>
                                        <form class="reportForm">
                                            {% csrf_token %}
                                            <input class="w3-radio" type="radio" name="content" value="إساءة شخصية">
                                            <label class="black-text">إساءة
                                                شخصية</label>
                                            <br>
                                            <input class="w3-radio" type="radio" name="content"
                                                value="مخالف لشروط إستخدام المنصة">
                                            <label class="black-text">مخالف
                                                لشروط إستخدام
                                                المنصة</label>
                                            <br>
                                            <input class="w3-radio" type="radio" name="content"
                                                value="إساءة لطائفة أو إلى الدين">
                                            <label class="black-text">إساءة
                                                لطائفة أو إلى
                                                الدين</label>
                                            <input type="hidden" name="reported_url" value="{{reply.get_noti_url}}">
                                            <input type="hidden" name="topic" value="reply">
                                            <br>
                                            <button type="submit"
                                                class="btn raykomfi-main-background-color send-report-btn">إرسال</button>

                                            <a class="btn red"
                                                onclick="document.getElementById('reportReply').style.display='none'">إغلاق</a>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- The Comment Report Modal -->
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% if user.email_active %}
        <div class="reply">
            <form class="replyForm" data-comment-id="{{comment.id}}">
                {% csrf_token %}
                <textarea name="reply_content" cols="40" rows="1" class="w3-input w3-border   reply-textarea"
                    id="id_reply_content-{{comment.id}}"></textarea>
                <div class="col s12">
                    <button class='w3-button z-depth-1' type="submit"> اضافة رد</button>
                </div>
            </form>
        </div>
        {% endif %}
    </div>
    <div class="w3-col s2 m1 l1 w3-center vote-side" id="comment-{{comment.id}}-vote-side-wrapper">
        <div>
            <form class="voteForm" data-comment-id="{{comment.id}}" data-user-id={{user.id}} data-vote-type="like">
                {% csrf_token %}
                <button type="submit" {% if user in comment.voted_like.all %} disabled {% endif %}
                    class="like-button"><i class="fa fa-thumbs-up" aria-hidden="true"></i></button>
            </form>
        </div>
        <div>{{comment.votes}}</div>
        <div>
            <form class="voteForm" data-comment-id="{{comment.id}}" data-user-id={{user.id}} data-vote-type="dislike">
                {% csrf_token %}
                <button type="submit" {% if user in comment.voted_dislike.all %} disabled {% endif %}
                    class="dislike-button"><i class="fa fa-thumbs-down" aria-hidden="true"></i></button>
            </form>
        </div>
    </div>
</div>
{% endfor %}
{% else %}
<p>لا يوجد رأي حتى الان, كن أول شخص يعطي رأيه</p>
{% endif %}