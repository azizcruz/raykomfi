{% load thumbnail %}
{% load humanize %}

<div class="comment-side">
    {% if comment.user and reply.user.is_active != False %}
    <a href="{% url 'raykomfi:user-profile' id=comment.post.creator.id %}" class="writer-name">
        <div class="name">
            <i class="fa fa-user" aria-hidden="true"></i>
            {{comment.user.username}}
            <span class="opinion-power">
                {{comment.user.user_trust}}
            </span>
        </div>
    </a>
    {% else %}
    <div class="name">
        <i class="fa fa-user" aria-hidden="true"></i>
        عضو لم يعد مسجل
    </div>
    {% endif %}
    <small><i class="fa fa-clock-o" aria-hidden="true"></i><span
            class="created-time">{{comment.created | naturaltime}}</span>
    </small>
    <div class="comment">{{ comment.content }}</div>
    <form class="editCommentForm-{{comment.id}} closest-edit-comment-form" data-comment-id="{{comment.id}}">
        {% csrf_token %}
        <input type="text" name="content" class="w3-input w3-border">
        <button class="btn raykomfi-main-background-color raykomfi-report-btn" type="submit">تأكيد</button>
        <a href="" class="btn red raykomfi-report-btn close-comment-edit-form"
            data-comment-id="{{comment.id}}">إلغاء</a>
    </form>
    {% if user.is_authenticated %}
    <button class="btn red raykomfi-report-btn comment-action-btn"
        onclick="document.getElementById('reportReply').style.display='block'">إبلاغ</button>
    {% if comment.user.id == user.id %}
    <button class="btn green raykomfi-report-btn comment-action-btn edit-comment-btn" data-comment-id="{{ comment.id }}"
        data-content="{{comment.content}}">تعديل </button>
    {% endif %}
    {% endif %}
    <!-- The Comment Report Modal -->
    <div id="reportComment" class="w3-modal">
        <div class="w3-modal-content w3-animate-top">
            <div class="container">
                <div class="col s12 m6">
                    <div class="card">
                        <div class="card-content white-text">
                            <h6>حدد نوع الإبلاغ</h6>
                            <form class="reportForm">
                                {% csrf_token %}
                                <input class="w3-radio" type="radio" name="content" value="إساءة شخصية">
                                <label class="black-text">إساءة
                                    شخصية</label>
                                <br>
                                <input class="w3-radio" type="radio" name="content" value="مخالف لشروط إستخدام المنصة">
                                <label class="black-text">مخالف
                                    لشروط إستخدام
                                    المنصة</label>
                                <br>
                                <input class="w3-radio" type="radio" name="content" value="إساءة لطائفة أو إلى الدين">
                                <label class="black-text">إساءة
                                    لطائفة أو إلى
                                    الدين</label>
                                <input type="hidden" name="reported_url" value="{{comment.get_absolute_url}}">
                                <br>

                                <input type="hidden" name="topic" value="comment">
                                <button type="submit"
                                    class="btn raykomfi-main-background-color send-report-btn">إرسال</button>

                                <a class="btn red"
                                    onclick="document.getElementById('reportComment').style.display='none'">إغلاق</a>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- The Comment Report Modal -->
</div>

{% if comment.replies.all|length > 0 %}
<div class="comment-reply-side w3-padding ">
    {% for reply in comment.replies.all %}
    <div class="w3-panel z-depth-1" id="to-{{reply.id}}">
        {% if reply.user and reply.user.is_active != False %}
        <a href="{% url 'raykomfi:user-profile' id=reply.user.id %}" class="writer-name">
            <div class="name"><i class="fa fa-user" aria-hidden="true"></i>
                {{reply.user.username}}
                <span class="opinion-power">
                    {{comment.user.user_trust}}
                </span>
            </div>
        </a>
        {% else %}
        <div class="name"><i class="fa fa-user" aria-hidden="true"></i>
            عضو لم يعد مسجل
        </div>
        {% endif %}
        <small><i class="fa fa-clock-o" aria-hidden="true"></i><span class="created-time">
                {{reply.created | naturaltime}}</span>
        </small>
        <div class="reply">{{ reply.content }}</div>
        <form class="editReplyForm-{{reply.id}} closest-edit-reply-form" data-comment-id="{{comment.id}}"
            data-reply-id="{{reply.id}}">
            {% csrf_token %}
            <input type="text" name="content" class="w3-input w3-border">
            <button class="btn raykomfi-main-background-color raykomfi-report-btn" type="submit">تأكيد</button>
            <a href="" class="btn red raykomfi-report-btn close-reply-edit-form" data-reply-id="{{reply.id}}">إلغاء</a>
        </form>
        {% if user.is_authenticated %}
        <button class="btn red raykomfi-report-btn reply-action-btn"
            onclick="document.getElementById('reportReply').style.display='block'">إبلاغ</button>
        {% if reply.user.id == user.id %}
        <button class="btn green raykomfi-report-btn reply-action-btn edit-reply-btn" data-reply-id="{{ reply.id }}"
            data-content="{{reply.content}}">تعديل
        </button>
        {% endif %}
        {% endif %}
        <!-- The Reply Report Modal -->
        <div id="reportReply" class="w3-modal">
            <div class="w3-modal-content w3-animate-top">
                <div class="container">
                    <div class="col s12 m6">
                        <div class="card">
                            <div class="card-content white-text">
                                <h6>حدد نوع الإبلاغ</h6>
                                <form class="reportForm">
                                    {% csrf_token %}
                                    <input class="w3-radio" type="radio" name="content" value="إساءة شخصية">
                                    <label class="black-text">إساءة
                                        شخصية</label>
                                    <br>
                                    <input class="w3-radio" type="radio" name="content"
                                        value="مخالف لشروط إستخدام المنصة">
                                    <label class="black-text">مخالف
                                        لشروط إستخدام
                                        المنصة</label>
                                    <br>
                                    <input class="w3-radio" type="radio" name="content"
                                        value="إساءة لطائفة أو إلى الدين">
                                    <label class="black-text">إساءة
                                        لطائفة أو إلى
                                        الدين</label>
                                    <input type="hidden" name="reported_url" value="{{reply.get_noti_url}}">
                                    <input type="hidden" name="topic" value="reply">
                                    <br>
                                    <button type="submit"
                                        class="btn raykomfi-main-background-color send-report-btn">إرسال</button>

                                    <a class="btn red"
                                        onclick="document.getElementById('reportReply').style.display='none'">إغلاق</a>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- The Comment Report Modal -->
    </div>
    {% endfor %}
</div>
{% endif %}
{% if user.email_active %}
<div class="reply">
    <form class="replyForm" data-comment-id="{{comment.id}}">
        {% csrf_token %}
        <textarea name="reply_content" cols="40" rows="1" class="w3-input w3-border   reply-textarea"
            id="id_reply_content-{{comment.id}}"></textarea>
        <div class="col s12">
            <button class='w3-button z-depth-1' type="submit"> اضافة رد</button>
        </div>
    </form>
</div>
{% endif %}